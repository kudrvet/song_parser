#!/usr/bin/env php
<?php
use App\App;

$autoloadPath1 = __DIR__ . '/../../../autoload.php';
$autoloadPath2 = __DIR__ . '/../vendor/autoload.php';

if (file_exists($autoloadPath1)) {
    require_once $autoloadPath1;
} else {
    require_once $autoloadPath2;
}

$doc = <<<DOC
Load artist information and songs library from soundcloud.com to database.

Usage:
  loadArtistLibrary (-h|--help)
  loadArtistLibrary (-v|--version)
  loadArtistLibrary  [--params <paramsQuery>] [--flag <paramsFlag>] <profileUrl>

Options:
  -h --help                     Show this screen
  -v --version                  Show version
  --params <paramsQuery>        Params [default: ]
  --flag <paramsFlag>           ParamsFlag [default: 1]
  <profileUrl>                  artist profile url on https://soundcloud.com/

DOC;
$args = Docopt::handle($doc, array('version'=>'loadArtistLibrary beta'));
$profileUrl = $args->args['<profileUrl>'];
//parse_str($args->args['--params'],$params);
$paramsFlag = $args->args['--flag'];
//var_dump($args->args['--params']);
$paramsString = $args->args['--params'];
$paramsData = explode(',',$paramsString);
//var_dump($paramsData);

$params = collect($paramsData)->flatMap(function($item) {
    [$key,$value] = explode('=',trim($item));
    return [trim($key) => trim($value)];
})->all();

//var_dump($params);
//var_dump($paramsFlag);
App::createDbConnection();
App::loadArtistAndSongsInfo($profileUrl, $params, $paramsFlag);
echo 'Artist library has successfully loaded !';
return 0;


